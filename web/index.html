<!DOCTYPE html>
<head>
	<title>Hello</title>
</head>
<body>
	<div>
		<label for="game_username">Username</label>
		<input id="game_username" type="text" autocomplete="off" spellcheck="false" placeholder="Username"></input>
		<button onclick="GCMJoin(ws, usernameEl.value)">Join</button>
	</div>
	<div id="game_players">
	</div>
	<div>
		Viewers:
		<span id="game_viewers">?</span>
	</div>
	<script src="gmt.js"></script>
	<script src="game.js"></script>
	<script>
		// E L E M E N T S
		const viewersEl = document.getElementById("game_viewers");
		const usernameEl = document.getElementById("game_username");
		const playersEl = document.getElementById("game_players");
		// M E S S A G E S
		function HandleServerInfoUsers(br) {
			const viewer_count = br.u32();
			const player_count = br.u32();
			const player_names = br.strn().split('\0');
			player_names.pop();
			playersEl.innerHTML = "";
			for (const i in player_names) {
				playersEl.innerHTML   += "<div class='player_entry'>\n";
				playersEl.textContent += player_names[i]+"\n";
				playersEl.innerHTML   += "</div>\n";
			}
			viewersEl.textContent = viewer_count;
		}
		// W E B S O C K E T S
		const ws = new WebSocket(`ws://${location.host}/ws`);
		ws.binaryType = "arraybuffer";
		ws.onopen = () => {
			//console.log('WS: open');
		};
		ws.onmessage = (event) => {
			const br = new ByteReader(event.data);
			msg_type = br.u8();
			switch (msg_type) {
				case GSMT.INFO_USERS: HandleServerInfoUsers(br); break;
			}
		}
	</script>
</body>
